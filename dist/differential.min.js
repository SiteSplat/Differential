/*!
 *
 * Differential
 *
 * Copyright (c) 2017 Karl Saunders (http://mobiuswebdesign.co.uk)
 * Licensed under MIT (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version: 0.0.1
 *
 */
!function(t,e){function i(e,i,h,a){e[s](o+i,"wheel"==n?h:function(e){!e&&(e=t.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==n?(i.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=-.025*e.wheelDeltaX)):i.deltaY=e.deltaY||e.detail,h(i)},a||!1)}var s,n,o="";t.addEventListener?s="addEventListener":(s="attachEvent",o="on"),n="onwheel"in e.createElement("div")?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll",t.addWheelListener=function(t,e,s){i(t,n,e,s),"DOMMouseScroll"==n&&i(t,"MozMousePixelScroll",e,s)}}(window,document),function(t){"use strict";function e(t,e,i){s.mixin(this),this.width=e,this.dragging=!1,this.pRect=i,this.offset=.5*i.width-.5*this.width,this.current=0,this.el=n.createElement("div",{class:"cmpr-handle"}),n.css(this.el,{left:this.offset,width:e}),t.appendChild(this.el),n.on(this.el,"mousedown",function(t){this.dragging=!0,this.origin=t.pageX,this.offsetX=t.offsetX,this.rect=n.getBoundingRect(this.el),this.emit("handle.mousedown")},this),n.on(document,"mousemove",function(t){this.dragging&&(this.limit(t),n.css(this.el,{transform:"translate3d("+this.current+"px,0px,0)"}),this.emit("handle.drag",t.pageX-this.pRect.left-this.offsetX)),this.emit("handle.mousemove")},this),n.on(document,"mouseup",function(t){this.dragging&&(this.dragging=!1,this.offset=t.pageX-this.pRect.left-this.offsetX,t.pageX<this.pRect.left&&(this.offset=0),t.pageX>this.pRect.left+this.pRect.width&&(this.offset=this.pRect.width-this.width),n.css(this.el,{transform:"",left:this.offset}),this.current=0,this.emit("handle.drag.end")),this.emit("handle.mouseup")},this)}function i(t,e,i,s,n,o,h){this.frame=t,this.rects=s,this.mouse={x:e,y:i},this.delta=n,this.magnitude=o,this.limitToFrame=h}var s=function(){};s.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},emit:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},s.mixin=function(t){for(var e=["on","off","emit"],i=0;i<e.length;i++)"function"==typeof t?t.prototype[e[i]]=s.prototype[e[i]]:t[e[i]]=s.prototype[e[i]];return t};var n={extend:function(t,e){e=e||{};var i;for(i in t)e.hasOwnProperty(i)||(e[i]=t[i]);return e},each:function(t,e,i){if("[object Object]"===Object.prototype.toString.call(t))for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(i,s,t[s],t);else for(var n=0,o=t.length;n<o;n++)e.call(i,n,t[n],t)},createElement:function(t,e){var i=document,s=i.createElement(t);if(e&&"object"==typeof e){var n;for(n in e)if("html"===n)s.innerHTML=e[n];else if("text"===n){var o=i.createTextNode(e[n]);s.appendChild(o)}else s.setAttribute(n,e[n])}return s},css:function(t,e,i){var s=t&&t.style,o="[object Object]"===Object.prototype.toString.call(e);if(s){if(void 0===i&&!o)return i=window.getComputedStyle(t,""),void 0===e?i:i[e];o?n.each(e,function(t,e){t in s||(t="-webkit-"+t),s[t]=e+("string"==typeof e?"":"px")}):(e in s||(e="-webkit-"+e),s[e]=i+("string"==typeof i?"":"px"))}},hasClass:function(t,e){return t.classList?t.classList.contains(e):!!t.className&&!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},addClass:function(t,e){n.hasClass(t,e)||(t.classList?t.classList.add(e):t.className=t.className.trim()+" "+e)},removeClass:function(t,e){n.hasClass(t,e)&&(t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," "))},on:function(t,e,i,s){t.addEventListener(e,function(t){s=s||this,i.call(s,t)},!1)},off:function(t,e,i){t.removeEventListener(e,i)},debounce:function(t,e,i){var s;return function(){var n=this,o=arguments,h=function(){s=null,i||t.apply(n,o)},a=i&&!s;clearTimeout(s),s=setTimeout(h,e),a&&t.apply(n,o)}},getBoundingRect:function(t,e){var i=window,s=document,o=s.body,h=t.getBoundingClientRect(),a=void 0!==i.pageXOffset?i.pageXOffset:(s.documentElement||o.parentNode||o).scrollLeft,r=void 0!==i.pageYOffset?i.pageYOffset:(s.documentElement||o.parentNode||o).scrollTop,l=0,c=0;return e&&(l=parseInt(n.css(t,"margin-top"),10),c=parseInt(n.css(t,"margin-left"),10)),{bottom:h.bottom+r,height:h.height,left:h.left+a-c,right:h.right+a,top:h.top+r-l,width:h.width}}},o={type:"side-by-side",handle:!0,handleWidth:5,zoom:!1,pan:!1,showLabels:!0};e.prototype={update:function(t){this.pRect=n.getBoundingRect(this.el.parentNode),this.current=0,this.offset=t||.5*this.pRect.width-.5*this.width,n.css(this.el,{left:this.offset})},limit:function(t){var e=t.pageX-this.origin;t.pageX-this.offsetX<=this.pRect.left&&(e=-this.offset),t.pageX+(this.width-this.offsetX)>=this.pRect.right&&(e=this.pRect.width-this.offset-this.width),this.current=e}};var h=function(t,e,i,s,n,o){this.originX=t,this.originY=e,this.transX=i,this.transY=s,this.scale=n,this.rects=o};h.prototype={getScale:function(){return this.scale},getOriginX:function(){return this.originX},getOriginY:function(){return this.originY},getTranslateX:function(){return this.transX},getTranslateY:function(){return this.transY},getBoundingRect:function(){return this.rects}};var a=function(t,e){this.element=t,this.magnification=!1,this.config=n.extend({zoom:!0,pan:!0,limitToFrame:!0},e),this.dragging=!1,this.update(),this.transform=new h(0,0,0,0,1,this.elRect),s.mixin(this),addWheelListener(t,this.onMouseWheel.bind(this)),n.on(t,"mousedown",this.onMouseDown.bind(this)),n.on(document,"mousemove",this.onMouseMove.bind(this)),n.on(document,"mouseup",this.onMouseUp.bind(this))};a.prototype={onMouseWheel:function(t){var e=Math.max(-1,Math.min(1,-t.deltaY));!this.magnification&&this.config.zoom&&(this.zoom(t.pageX,t.pageY,!1,e),t.preventDefault())},onMouseDown:function(t){this.config.pan&&(this.elRect=n.getBoundingRect(this.element),this.getTransform().scale>1&&(this.dragOrigin={x:t.pageX,y:t.pageY},this.dragging=!0,t.preventDefault()),this.emit("frame.mousedown"))},onMouseMove:function(t){if(this.dragging){var e=this.limit(t);this.applyTransform(this.getTransform(),e),this.emit("frame.pan")}},onMouseUp:function(t){if(this.dragging){this.dragging=!1;var e=this.getTransform(),i=this.limit(t);e.transX+=i.x,e.transY+=i.y}this.emit("frame.mouseup")},zoom:function(t,e,s,o){t=t||.5*this.elRect.width,e=e||.5*this.elRect.height;var h=this.getTransform(),a=new i(h,t,e,this.elRect,o,s,this.config.limitToFrame);this.setMagnification(a),h=a.magnify(),this.applyTransform(h),this.setTransform(h),this.setMagnification(),this.elRect=n.getBoundingRect(this.element),this.emit("frame.zoom",o,h)},update:function(){this.elRect=n.getBoundingRect(this.element),this.ptRect=n.getBoundingRect(this.element.parentNode)},setTransform:function(t){this.transform=t},getTransform:function(){return this.transform},setMagnification:function(t){t=t||!1,this.magnification=t},limit:function(t){var e=this.ptRect,i=this.elRect,s={x:t.pageX-this.dragOrigin.x,y:t.pageY-this.dragOrigin.y};return this.config.limitToFrame&&(i.top+s.y>=e.top&&(s.y=e.top-i.top),i.bottom+s.y<=e.bottom&&(s.y=e.top-i.top-(i.height-e.height)),i.left+s.x>e.left&&(s.x=e.left-i.left),i.right+s.x<=e.right&&(s.x=e.left-i.left-(i.width-e.width))),s},applyTransform:function(t,e){var i,s=t.getScale().toFixed(1),o=t.getTranslateX(),h=t.getTranslateY(),a=[t.getOriginX().toFixed(10),t.getOriginY().toFixed(10),0];e&&(o+=e.x,h+=e.y),(i=["matrix("+t.getScale().toFixed(1)]).push(0),i.push(0),i.push(s),i.push(o.toFixed(1)),i.push(h.toFixed(1)+")"),n.css(this.element,{"transform-origin":a.join("px "),transform:i.join(",")})}},i.prototype={magnify:function(){var t=this.frame.getScale(),e=this.magnitude||t+this.delta/10;e<1?e=1:e>20&&(e=20);var i=(this.mouse.x-this.rects.left).toFixed(2),s=(this.mouse.y-this.rects.top).toFixed(2),n=(this.frame.getOriginX()*t).toFixed(2),o=(this.frame.getOriginY()*t).toFixed(2),a=this.frame.getTranslateX(),r=this.frame.getTranslateY(),l=i/t,c=s/t;if((Math.abs(i-n)>1||Math.abs(s-o)>1)&&t<20?(a+=(i-n)*(1-1/t),r+=(s-o)*(1-1/t)):(1!=t||i!=n&&s!=o)&&(l=n/t,c=o/t),this.delta<=0&&(this.limitToFrame||1==e)){var f=this.rects.width,d=this.rects.height;a+l+(f-l)*e<=f?(a=0,l=f):a+l*(1-e)>=0&&(a=0,l=0),r+c+(d-c)*e<=d?(r=0,c=d):r+c*(1-e)>=0&&(r=0,c=0)}return new h(l,c,a,r,e,this.rects)}};var r=function(t,e){this.parent=t,"string"==typeof t&&(this.parent=document.querySelector(t)),s.mixin(this),this.config=n.extend(o,e),this.rect=n.getBoundingRect(this.parent),this.images=[],this.width=0,this.height=0,this.naturalWidth=0,this.naturalHeight=0,this.initialised=!1,this.container=n.createElement("div",{class:"cmpr-container"}),this.imageWrapper=n.createElement("div",{class:"cmpr-image-wrapper"});var i;this.config.showLabels&&(i=n.createElement("div",{class:"cmpr-labels"}),this.labels=[]),n.each(this.config.images,function(t,e){if(this.images[t]=n.createElement("img",{class:"cmpr-image",src:e.src,title:e.label}),this.images[t].idx=t,0===t&&this.images[t].classList.add("top"),this.config.showLabels&&e.label){var s=n.createElement("div",{class:"cmpr-label "+(t>0?"right":"left"),html:e.label});i.appendChild(s),this.labels[t]={node:s,label:e.label}}this.imageWrapper.appendChild(this.images[t]),n.on(this.images[t],"load",this.onImageLoaded.bind(this))},this),this.container.appendChild(i),this.container.appendChild(this.imageWrapper)};r.prototype.onImageLoaded=function(t){var e=t.currentTarget;e.naturalHeight>this.height&&(this.naturalHeight=e.naturalHeight),e.naturalWidth>this.width&&(this.naturalWidth=e.naturalWidth),e.idx>0&&this.init()},r.prototype.init=function(){if(this.initialised)return!1;this.parent.appendChild(this.container),this.topImage=this.images[0];var t=this;if(this.ratio=this.rect.width/this.naturalWidth,this.height=this.naturalHeight*this.ratio,this.width=this.naturalWidth*this.ratio,n.css(this.container,{height:this.height,width:this.width}),this.setLabels(),this.frame=new a(this.imageWrapper,{zoom:this.config.zoom,pan:this.config.pan,limitToFrame:"side-by-side"===this.config.type||"hover"===this.config.type}),this.config.zoom&&(this.enableZoom(),this.config.pan&&this.enablePan()),"side-by-side"===this.config.type)this.container.classList.add("side-by-side"),this.handle=new e(this.container,this.config.handleWidth,this.rect),this.handle.on("handle.drag",function(e){if(t.config.showLabels&&t.labels.length){var i,s=!1;n.each(t.labels,function(n,o){i=o.node.classList,s=0===n&&e<=o.rect.left-t.rect.left+o.rect.width||1==n&&e>=o.rect.left-t.rect.left,o.node.classList.toggle("hide",s)})}t.setClip()}),this.setClip();else if("layered"===this.config.type)this.container.classList.add("layered");else if("hover"===this.config.type){this.container.classList.add("hover"),this.labels[0].node.classList.add("docked");var i=n.createElement("div",{class:"cmpr-window"});this.container.appendChild(i),this.window={node:i,rect:n.getBoundingRect(i),mouse:{x:0,y:0}},this.toggleImages(),n.on(this.parent,"mousemove",function(t){this.window.mouse={x:t.offsetX,y:t.offsetY},this.setClip()},this)}n.on(this.container,"mousedown",function(t){return t.preventDefault(),!1}),this.resize=n.debounce(function(){var t,e=this.rect;this.rect=n.getBoundingRect(this.parent),this.ratio=this.rect.width/this.naturalWidth,this.height=this.naturalHeight*this.ratio,this.width=this.naturalWidth*this.ratio,n.css(this.container,{height:this.height,width:this.width}),this.frame.update(),"side-by-side"===this.config.type&&(t=this.rect.width*(this.handle.offset/e.width),this.handle.update(t));var i=this.frame.getTransform();this.frame.applyTransform(i),this.frame.setTransform(i),this.frame.setMagnification(),this.setClip(),this.setLabels()},50),n.on(window,"resize",this.resize.bind(this)),this.resize();var s=this;setTimeout(function(){s.emit("init"),s.initialised=!0},10)},r.prototype.setLabels=function(){this.config.showLabels&&this.labels.length&&n.each(this.labels,function(t,e){e.rect=n.getBoundingRect(e.node)},this)},r.prototype.setClip=function(){if("layered"===this.config.type)return!1;var t,e,i,s,o,h,a=n.getBoundingRect(this.imageWrapper),r=this.frame.getTransform().getScale(),l=this.rect.left-a.left,c=this.rect.top-a.top;"hover"===this.config.type?(i=this.window.mouse.y-.5*this.window.rect.height/r,o=(s=this.window.mouse.x-.5*this.window.rect.width/r)+this.window.rect.width/r,h=i+this.window.rect.height/r,t=s*r-l,e=i*r-c,n.css(this.window.node,{transform:"translate3d("+t+"px, "+e+"px, 0px)"}),n.css(this.labels[0].node,{width:this.window.rect.width,top:-this.labels[0].rect.height,transform:"translate3d("+t+"px, "+e+"px, 0px)"})):(i=0,s=0,o=l/r+(this.handle.offset+this.handle.current+this.ratio)/r,h=this.height),n.css(this.topImage,{clip:["rect("+i,o,h,s+"px)"].join("px, ")})},r.prototype.onZoom=function(t,e){var i=this;this.container.classList.toggle("pan",e.scale>1),this.container.classList.toggle("zoom-in",t>0),e.scale>1&&this.container.classList.toggle("zoom-out",t<0),this.setClip(),setTimeout(function(){i.container.classList.remove("zoom-in","zoom-out")},200)},r.prototype.enableZoom=function(){this.frame.config.zoom=!0,this.container.classList.add("zoomable"),this.frame.on("frame.zoom",this.onZoom.bind(this))},r.prototype.disableZoom=function(){this.frame.config.zoom=!1,this.container.classList.remove("zoomable"),this.frame.off("frame.zoom",this.onZoom.bind(this))},r.prototype.zoom=function(t,e,i,s){t+=this.frame.ptRect.left,e+=this.frame.ptRect.top,this.frame.zoom(t,e,i,s?-1:1)},r.prototype.enablePan=function(){this.frame.config.pan=!0,this.container.classList.add("pannable"),this.frame.on("frame.pan",this.onPan.bind(this))},r.prototype.disablePan=function(){this.frame.config.pan=!1,this.container.classList.remove("pannable"),this.frame.off("frame.pan",this.onPan.bind(this))},r.prototype.onPan=function(){this.setClip()},r.prototype.toggleImages=function(){var t,e;n.each(this.images,function(i,s){t=s.classList,(e=t.contains("top"))?n.css(s,{clip:""}):this.topImage=s,t.toggle("top",!e)},this),this.swapLabels(),this.setClip()},r.prototype.swapLabels=function(){var t,e;n.each(this.labels,function(i,s){t=s.node.classList,e=t.contains("left"),t.toggle("left",!e),t.toggle("right",e),"hover"===this.config.type&&(t.contains("docked")?(n.css(s.node,{top:"",width:"",transform:""}),t.remove("docked")):t.add("docked"))},this),this.labels[0].node.parentNode.appendChild(this.labels[0].node),this.labels.reverse(),this.setLabels()},t.Differential=r}(this);
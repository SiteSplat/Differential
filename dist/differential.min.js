/*!
 *
 * Differential
 *
 * Copyright (c) 2017 Karl Saunders (http://mobiuswebdesign.co.uk)
 * Licensed under MIT (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version: 0.0.3
 *
 */
!function(t,e){function i(e,i,h,a){e[s](o+i,"wheel"==n?h:function(e){!e&&(e=t.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==n?(i.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=-.025*e.wheelDeltaX)):i.deltaY=e.deltaY||e.detail,h(i)},a||!1)}var s,n,o="";t.addEventListener?s="addEventListener":(s="attachEvent",o="on"),n="onwheel"in e.createElement("div")?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll",t.addWheelListener=function(t,e,s){i(t,n,e,s),"DOMMouseScroll"==n&&i(t,"MozMousePixelScroll",e,s)}}(window,document),function(t){"use strict";function e(t,e,n){i.mixin(this),this.width=e,this.dragging=!1,this.pRect=n,this.offset=.5*n.width-.5*this.width,this.current=0,this.el=s.createElement("div",{class:"cmpr-handle"}),s.css(this.el,{left:this.offset,width:e}),t.appendChild(this.el),s.on(this.el,"mousedown",function(t){this.dragging=!0,this.origin=t.pageX,this.offsetX=t.offsetX,this.rect=s.getBoundingRect(this.el),this.emit("handle.mousedown")},this),s.on(document,"mousemove",function(t){this.dragging&&(this.limit(t),s.css(this.el,{transform:"translate3d("+this.current+"px,0px,0)"}),this.emit("handle.drag",t.pageX-this.pRect.left-this.offsetX)),this.emit("handle.mousemove")},this),s.on(document,"mouseup",function(t){this.dragging&&(this.dragging=!1,this.offset=t.pageX-this.pRect.left-this.offsetX,t.pageX<this.pRect.left&&(this.offset=0),t.pageX>this.pRect.left+this.pRect.width&&(this.offset=this.pRect.width-this.width),s.css(this.el,{transform:"",left:this.offset}),this.current=0,this.emit("handle.drag.end")),this.emit("handle.mouseup")},this)}var i=function(){};i.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},emit:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},i.mixin=function(t){for(var e=["on","off","emit"],s=0;s<e.length;s++)"function"==typeof t?t.prototype[e[s]]=i.prototype[e[s]]:t[e[s]]=i.prototype[e[s]];return t};var s={extend:function(t,e){e=e||{};var i;for(i in t)e.hasOwnProperty(i)||(e[i]=t[i]);return e},each:function(t,e,i){if("[object Object]"===Object.prototype.toString.call(t))for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(i,s,t[s],t);else for(var n=0,o=t.length;n<o;n++)e.call(i,n,t[n],t)},createElement:function(t,e){var i=document,s=i.createElement(t);if(e&&"object"==typeof e){var n;for(n in e)if("html"===n)s.innerHTML=e[n];else if("text"===n){var o=i.createTextNode(e[n]);s.appendChild(o)}else s.setAttribute(n,e[n])}return s},css:function(t,e,i){var n=t&&t.style,o="[object Object]"===Object.prototype.toString.call(e);if(n){if(void 0===i&&!o)return i=window.getComputedStyle(t,""),void 0===e?i:i[e];o?s.each(e,function(t,e){t in n||(t="-webkit-"+t),n[t]=e+("string"==typeof e?"":"px")}):(e in n||(e="-webkit-"+e),n[e]=i+("string"==typeof i?"":"px"))}},hasClass:function(t,e){return t.classList?t.classList.contains(e):!!t.className&&!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},addClass:function(t,e){s.hasClass(t,e)||(t.classList?t.classList.add(e):t.className=t.className.trim()+" "+e)},removeClass:function(t,e){s.hasClass(t,e)&&(t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," "))},on:function(t,e,i,s){t.addEventListener(e,function(t){s=s||this,i.call(s,t)},!1)},off:function(t,e,i){t.removeEventListener(e,i)},debounce:function(t,e,i){var s;return function(){var n=this,o=arguments,h=function(){s=null,i||t.apply(n,o)},a=i&&!s;clearTimeout(s),s=setTimeout(h,e),a&&t.apply(n,o)}},getBoundingRect:function(t,e){var i=window,n=document,o=n.body,h=t.getBoundingClientRect(),a=void 0!==i.pageXOffset?i.pageXOffset:(n.documentElement||o.parentNode||o).scrollLeft,r=void 0!==i.pageYOffset?i.pageYOffset:(n.documentElement||o.parentNode||o).scrollTop,l=0,c=0;return e&&(l=parseInt(s.css(t,"margin-top"),10),c=parseInt(s.css(t,"margin-left"),10)),{bottom:h.bottom+r,height:h.height,left:h.left+a-c,right:h.right+a,top:h.top+r-l,width:h.width}}},n={type:"side-by-side",handle:!0,handleWidth:5,zoom:!1,pan:!1,showLabels:!0};e.prototype={update:function(t){this.pRect=s.getBoundingRect(this.el.parentNode),this.current=0,this.offset=t||.5*this.pRect.width-.5*this.width,s.css(this.el,{left:this.offset})},limit:function(t){var e=t.pageX-this.origin;t.pageX-this.offsetX<=this.pRect.left&&(e=-this.offset),t.pageX+(this.width-this.offsetX)>=this.pRect.right&&(e=this.pRect.width-this.offset-this.width),this.current=e}};var o=function(t,e,i,s,n,o){this.originX=t,this.originY=e,this.transX=i,this.transY=s,this.scale=n,this.rects=o};o.prototype={getScale:function(){return this.scale},getOriginX:function(){return this.originX},getOriginY:function(){return this.originY},getTranslateX:function(){return this.transX},getTranslateY:function(){return this.transY},getBoundingRect:function(){return this.rects}};var h=function(t,e){this.element=t,this.config=s.extend({zoom:!0,pan:!0,limitToFrame:!0},e),this.dragging=!1,this.update(),this.transform=new o(0,0,0,0,1,this.elRect),i.mixin(this),addWheelListener(t,this.onMouseWheel.bind(this)),s.on(t,"mousedown",this.onMouseDown.bind(this)),s.on(document,"mousemove",this.onMouseMove.bind(this)),s.on(document,"mouseup",this.onMouseUp.bind(this))};h.prototype={onMouseWheel:function(t){var e=Math.max(-1,Math.min(1,-t.deltaY));this.config.zoom&&(this.zoom(t.pageX,t.pageY,!1,e),t.preventDefault())},onMouseDown:function(t){this.config.pan&&(this.elRect=s.getBoundingRect(this.element),this.getTransform().scale>1&&(this.dragOrigin={x:t.pageX,y:t.pageY},this.dragging=!0,t.preventDefault()),this.emit("frame.mousedown"))},onMouseMove:function(t){if(this.dragging){var e=this.pan(t);this.applyTransform(this.getTransform(),e),this.emit("frame.pan")}},onMouseUp:function(t){if(this.dragging){this.dragging=!1;var e=this.getTransform(),i=this.pan(t);e.transX+=i.x,e.transY+=i.y}this.emit("frame.mouseup")},zoom:function(t,e,i,n){t=t||.5*this.elRect.width,e=e||.5*this.elRect.height;var h=this.transform.getScale(),a=i||h+n/10;a<1?a=1:a>20&&(a=20);var r=(t-this.elRect.left).toFixed(2),l=(e-this.elRect.top).toFixed(2),c=(this.transform.getOriginX()*h).toFixed(2),f=(this.transform.getOriginY()*h).toFixed(2),d=this.transform.getTranslateX(),p=this.transform.getTranslateY(),g=r/h,m=l/h;if((Math.abs(r-c)>1||Math.abs(l-f)>1)&&h<20?(d+=(r-c)*(1-1/h),p+=(l-f)*(1-1/h)):(1!=h||r!=c&&l!=f)&&(g=c/h,m=f/h),n<=0&&(this.config.limitToFrame||1==a)){var u=this.elRect.width,w=this.elRect.height;d+g+(u-g)*a<=u?(d=0,g=u):d+g*(1-a)>=0&&(d=0,g=0),p+m+(w-m)*a<=w?(p=0,m=w):p+m*(1-a)>=0&&(p=0,m=0)}this.transform=new o(g,m,d,p,a,this.elRect),this.applyTransform(),this.elRect=s.getBoundingRect(this.element),this.emit("frame.zoom",n)},update:function(){this.elRect=s.getBoundingRect(this.element),this.ptRect=s.getBoundingRect(this.element.parentNode)},setTransform:function(t){this.transform=t},getTransform:function(){return this.transform},pan:function(t){var e=this.ptRect,i=this.elRect,s={x:t.pageX-this.dragOrigin.x,y:t.pageY-this.dragOrigin.y};return this.config.limitToFrame&&(i.top+s.y>=e.top&&(s.y=e.top-i.top),i.bottom+s.y<=e.bottom&&(s.y=e.top-i.top-(i.height-e.height)),i.left+s.x>e.left&&(s.x=e.left-i.left),i.right+s.x<=e.right&&(s.x=e.left-i.left-(i.width-e.width))),s},applyTransform:function(t,e){var i,n=this.transform.getScale().toFixed(1),o=this.transform.getTranslateX(),h=this.transform.getTranslateY(),a=[this.transform.getOriginX().toFixed(10),this.transform.getOriginY().toFixed(10),0];e&&(o+=e.x,h+=e.y),(i=["matrix("+this.transform.getScale().toFixed(1)]).push(0),i.push(0),i.push(n),i.push(o.toFixed(1)),i.push(h.toFixed(1)+")"),s.css(this.element,{"transform-origin":a.join("px "),transform:i.join(",")})}};var a=function(t,e){this.parent=t,"string"==typeof t&&(this.parent=document.querySelector(t)),i.mixin(this),this.config=s.extend(n,e),this.rect=s.getBoundingRect(this.parent),this.images=[],this.width=0,this.height=0,this.naturalWidth=0,this.naturalHeight=0,this.initialised=!1,this.container=s.createElement("div",{class:"cmpr-container"}),this.imageWrapper=s.createElement("div",{class:"cmpr-image-wrapper"});var o;this.config.showLabels&&(o=s.createElement("div",{class:"cmpr-labels"}),this.labels=[]),s.each(this.config.images,function(t,e){if(this.images[t]=s.createElement("img",{class:"cmpr-image",src:e.src,title:e.label}),this.images[t].idx=t,0===t&&this.images[t].classList.add("top"),this.config.showLabels&&e.label){var i=s.createElement("div",{class:"cmpr-label "+(t>0?"right":"left"),html:e.label});o.appendChild(i),this.labels[t]={node:i,label:e.label}}this.imageWrapper.appendChild(this.images[t]),s.on(this.images[t],"load",this.onImageLoaded.bind(this))},this),this.container.appendChild(o),this.container.appendChild(this.imageWrapper)};a.prototype.onImageLoaded=function(t){var e=t.currentTarget;e.naturalHeight>this.height&&(this.naturalHeight=e.naturalHeight),e.naturalWidth>this.width&&(this.naturalWidth=e.naturalWidth),e.idx>0&&this.init()},a.prototype.init=function(){if(this.initialised)return!1;this.parent.appendChild(this.container),this.topImage=this.images[0];var t=this;if(this.ratio=this.rect.width/this.naturalWidth,this.height=this.naturalHeight*this.ratio,this.width=this.naturalWidth*this.ratio,s.css(this.container,{height:this.height,width:this.width}),this.setLabels(),this.frame=new h(this.imageWrapper,{zoom:this.config.zoom,pan:this.config.pan,limitToFrame:"side-by-side"===this.config.type||"hover"===this.config.type}),this.config.zoom&&(this.enableZoom(),this.config.pan&&this.enablePan()),"side-by-side"===this.config.type)this.container.classList.add("side-by-side"),this.handle=new e(this.container,this.config.handleWidth,this.rect),this.handle.on("handle.drag",function(e){if(t.config.showLabels&&t.labels.length){var i,n=!1;s.each(t.labels,function(s,o){i=o.node.classList,n=0===s&&e<=o.rect.left-t.rect.left+o.rect.width||1==s&&e>=o.rect.left-t.rect.left,o.node.classList.toggle("hide",n)})}t.setClip()}),this.setClip();else if("layered"===this.config.type)this.container.classList.add("layered");else if("hover"===this.config.type){this.container.classList.add("hover"),this.labels[0].node.classList.add("docked");var i=s.createElement("div",{class:"cmpr-window"});this.container.appendChild(i),this.window={node:i,rect:s.getBoundingRect(i),mouse:{x:0,y:0}},this.toggleImages(),s.on(this.parent,"mousemove",function(t){this.window.mouse={x:t.offsetX,y:t.offsetY};var e=t.pageX-this.rect.left-.5*this.window.rect.width,i=t.pageY-this.rect.top-.5*this.window.rect.height;s.css(this.window.node,{transform:"translate3d("+e+"px, "+i+"px, 0px)"}),s.css(this.labels[0].node,{width:this.window.rect.width,top:-this.labels[0].rect.height,transform:"translate3d("+e+"px, "+i+"px, 0px)"}),this.setClip()},this)}s.on(this.container,"mousedown",function(t){return t.preventDefault(),!1}),this.resize=s.debounce(function(){var t,e=this.rect;this.rect=s.getBoundingRect(this.parent),this.ratio=this.rect.width/this.naturalWidth,this.height=this.naturalHeight*this.ratio,this.width=this.naturalWidth*this.ratio,s.css(this.container,{height:this.height,width:this.width}),this.frame.update(),"side-by-side"===this.config.type&&(t=this.rect.width*(this.handle.offset/e.width),this.handle.update(t));var i=this.frame.getTransform();this.frame.applyTransform(i),this.setClip(),this.setLabels()},50),s.on(window,"resize",this.resize.bind(this)),this.resize();var n=this;setTimeout(function(){n.emit("init"),n.initialised=!0},10)},a.prototype.setLabels=function(){this.config.showLabels&&this.labels.length&&s.each(this.labels,function(t,e){e.rect=s.getBoundingRect(e.node)},this)},a.prototype.setClip=function(){if("layered"===this.config.type)return!1;var t,e,i,n,o=this.frame.getTransform().getScale();if("hover"===this.config.type)t=this.window.mouse.y-.5*this.window.rect.height/o,i=(e=this.window.mouse.x-.5*this.window.rect.width/o)+this.window.rect.width/o,n=t+this.window.rect.height/o;else{var h=s.getBoundingRect(this.imageWrapper);t=0,e=0,i=(this.rect.left-h.left)/o+(this.handle.offset+this.handle.current+this.ratio)/o,n=this.height}s.css(this.topImage,{clip:["rect("+t,i,n,e+"px)"].join("px, ")})},a.prototype.onZoom=function(t){var e=this,i=this.frame.getTransform();this.container.classList.toggle("pan",i.getScale()>1),this.container.classList.toggle("zoom-in",t>0),i.scale>1&&this.container.classList.toggle("zoom-out",t<0),this.setClip(),setTimeout(function(){e.container.classList.remove("zoom-in","zoom-out")},200)},a.prototype.enableZoom=function(){this.frame.config.zoom=!0,this.container.classList.add("zoomable"),this.frame.on("frame.zoom",this.onZoom.bind(this))},a.prototype.disableZoom=function(){this.frame.config.zoom=!1,this.container.classList.remove("zoomable"),this.frame.off("frame.zoom",this.onZoom.bind(this))},a.prototype.zoom=function(t,e,i,s){t+=this.frame.ptRect.left,e+=this.frame.ptRect.top,this.frame.zoom(t,e,i,s?-1:1)},a.prototype.enablePan=function(){this.frame.config.pan=!0,this.container.classList.add("pannable"),this.frame.on("frame.pan",this.onPan.bind(this))},a.prototype.disablePan=function(){this.frame.config.pan=!1,this.container.classList.remove("pannable"),this.frame.off("frame.pan",this.onPan.bind(this))},a.prototype.onPan=function(){this.setClip()},a.prototype.toggleImages=function(){var t,e;s.each(this.images,function(i,n){t=n.classList,(e=t.contains("top"))?s.css(n,{clip:""}):this.topImage=n,t.toggle("top",!e)},this),this.swapLabels(),this.setClip()},a.prototype.swapLabels=function(){var t,e;s.each(this.labels,function(i,n){t=n.node.classList,e=t.contains("left"),t.toggle("left",!e),t.toggle("right",e),"hover"===this.config.type&&(t.contains("docked")?(s.css(n.node,{top:"",width:"",transform:""}),t.remove("docked")):t.add("docked"))},this),this.labels[0].node.parentNode.appendChild(this.labels[0].node),this.labels.reverse(),this.setLabels()},t.Differential=a}(this);